<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.8">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>General Chat with Multiple LLMs :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1753495745" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1753495745" rel="stylesheet">
    <link href="/css/hybrid.css?1753495745" rel="stylesheet">
    <link href="/css/featherlight.min.css?1753495745" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1753495745" rel="stylesheet">
    <link href="/css/auto-complete.css?1753495745" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1753495745" rel="stylesheet">
    <link href="/css/theme.css?1753495745" rel="stylesheet">
    <link href="/css/hugo-theme.css?1753495745" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1753495745" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1753495745"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/6-usingamazonkendra/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1753495745"></script>
<script type="text/javascript" src="/js/auto-complete.js?1753495745"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1753495745"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/">
           <b> 1. </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-prerequiste/" title="Preparation " class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/">
           <b> 2. </b> Preparation 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.1-launchastack/" title="Launch a CloudFormation stack" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.1-launchastack/">
           <b> 2.1 </b> Launch a CloudFormation stack
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.2-launchvscode/" title="Launch VSCode on AWS, and Set Up the Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.2-launchvscode/">
           <b> 2.2 </b> Launch VSCode on AWS, and Set Up the Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-accessibilitytoinstances/" title="Deploy Amazon Bedrock Serverless Application" class="dd-item 
        
        
        
        ">
      <a href="/3-accessibilitytoinstances/">
           <b> 3. </b> Deploy Amazon Bedrock Serverless Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-walkthroughbedrock/" title="Walkthrough Amazon Bedrock Console" class="dd-item 
        
        
        
        ">
      <a href="/4-walkthroughbedrock/">
           <b> 4. </b> Walkthrough Amazon Bedrock Console
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-multiplellms/" title="General Chat with Multiple LLMs" class="dd-item 
        
        
        
        ">
      <a href="/5-multiplellms/">
           <b> 5. </b> General Chat with Multiple LLMs
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-usingamazonkendra/" title="General Chat with Multiple LLMs" class="dd-item 
        
        active
        
        ">
      <a href="/6-usingamazonkendra/">
           <b> 5. </b> General Chat with Multiple LLMs
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-cleanup/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/6-cleanup/">
          <b>6. </b>Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/6-usingamazonkendra/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/6-usingamazonkendra/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/hiepnguyendt"  style="color:orange">Thanh Hiệp </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Create a Serverless Chatbot Using Amazon Bedrock, Amazon Kendra, and Your Own Data</a> > General Chat with Multiple LLMs
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#test-using-ui">Test using UI</a>
      <ul>
        <li><a href="#task-complete">Task Complete</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              General Chat with Multiple LLMs
            </h1>
          

        



	
<div class="notices info" ><p><strong>Port Forwarding</strong> is a useful way to redirect network traffic from one IP address - Port to another IP address - Port. With <strong>Port Forwarding</strong> we can access an EC2 instance located in the private subnet from our workstation.</p>
</div>

<p>You have successfully deployed the Amazon Bedrock serverless chatbot application, using AWS SAM for the backend and AWS Amplify for the frontend. The frontend serves as a basic user interface for testing the solution with various questions and prompt parameters. In this section, you will update and deploy a LLM Lambda function, this function enables with a general chat with multiple large language models.</p>
<ol>
<li>Open the VSCode editor (as discussed in Task 1).</li>
<li>From bedrock-serverless-workshop project, open /lambdas/llmFunctions/llmfunction.py function, copy the below code and update the function code. This function carries the logic to support Claud3 (Haiku, Sonnet etc.), Mistral and Llama models.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>import boto3
</span></span><span style="display:flex;"><span>import json
</span></span><span style="display:flex;"><span>import traceback
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>region <span style="color:#f92672">=</span> boto3.session.Session<span style="color:#f92672">()</span>.region_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def lambda_handler<span style="color:#f92672">(</span>event, context<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>    boto3_version <span style="color:#f92672">=</span> boto3.__version__
</span></span><span style="display:flex;"><span>    print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;Boto3 version: {boto3_version}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;Event is: {event}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    event_body <span style="color:#f92672">=</span> json.loads<span style="color:#f92672">(</span>event<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>    prompt <span style="color:#f92672">=</span> event_body<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;query&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    temperature <span style="color:#f92672">=</span> event_body<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;temperature&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    max_tokens <span style="color:#f92672">=</span> event_body<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;max_tokens&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    model_id <span style="color:#f92672">=</span> event_body<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;model_id&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    status_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> model_id <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;mistral.mistral-7b-instruct-v0:2&#39;</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> invoke_mistral_7b<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> model_id <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;meta.llama3-1-8b-instruct-v1:0&#39;</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> invoke_llama<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> invoke_claude<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;statusCode&#39;</span>: status_code,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;headers&#39;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Origin&#39;</span>: <span style="color:#e6db74">&#39;*&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Headers&#39;</span>: <span style="color:#e6db74">&#39;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Methods&#39;</span>: <span style="color:#e6db74">&#39;OPTIONS,POST&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;body&#39;</span>: json.dumps<span style="color:#f92672">({</span><span style="color:#e6db74">&#39;answer&#39;</span>: response<span style="color:#f92672">})</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;An unexpected error occurred: {str(e)}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        stack_trace <span style="color:#f92672">=</span> traceback.format_exc<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>stack_trace<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;statusCode&#39;</span>: status_code,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;headers&#39;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Origin&#39;</span>: <span style="color:#e6db74">&#39;*&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Headers&#39;</span>: <span style="color:#e6db74">&#39;Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Access-Control-Allow-Methods&#39;</span>: <span style="color:#e6db74">&#39;OPTIONS,POST&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;body&#39;</span>: json.dumps<span style="color:#f92672">({</span><span style="color:#e6db74">&#39;error&#39;</span>: str<span style="color:#f92672">(</span>e<span style="color:#f92672">)})</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def invoke_claude<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        instruction <span style="color:#f92672">=</span> f<span style="color:#e6db74">&#34;Human: {prompt} nAssistant:&#34;</span>
</span></span><span style="display:flex;"><span>        bedrock_runtime_client <span style="color:#f92672">=</span> boto3.client<span style="color:#f92672">(</span>service_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bedrock-runtime&#34;</span>, region_name<span style="color:#f92672">=</span>region<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        body<span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;anthropic_version&#34;</span>: <span style="color:#e6db74">&#34;bedrock-2023-05-31&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;max_tokens&#34;</span>: max_tokens,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;messages&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;content&#34;</span>: <span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: prompt<span style="color:#f92672">}]</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> bedrock_runtime_client.invoke_model<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            modelId<span style="color:#f92672">=</span>model_id, body<span style="color:#f92672">=</span>json.dumps<span style="color:#f92672">(</span>body<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> json.loads<span style="color:#f92672">(</span>response<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">]</span>.read<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        outputs <span style="color:#f92672">=</span> response_body.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        completions <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>output<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;text&#34;</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">for</span> output in outputs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;completions: {completions[0]}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> completions<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        raise
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>def invoke_mistral_7b<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>        instruction <span style="color:#f92672">=</span> f<span style="color:#e6db74">&#34;&lt;s&gt;[INST] {prompt} [/INST]&#34;</span>
</span></span><span style="display:flex;"><span>        bedrock_runtime_client <span style="color:#f92672">=</span> boto3.client<span style="color:#f92672">(</span>service_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bedrock-runtime&#34;</span>, region_name<span style="color:#f92672">=</span>region<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        body <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;prompt&#34;</span>: instruction,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;max_tokens&#34;</span>: max_tokens,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;temperature&#34;</span>: temperature,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> bedrock_runtime_client.invoke_model<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            modelId<span style="color:#f92672">=</span>model_id, body<span style="color:#f92672">=</span>json.dumps<span style="color:#f92672">(</span>body<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> json.loads<span style="color:#f92672">(</span>response<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">]</span>.read<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        outputs <span style="color:#f92672">=</span> response_body.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;outputs&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;response: {outputs}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        completions <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>output<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;text&#34;</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">for</span> output in outputs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> completions<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        raise
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>def invoke_llama<span style="color:#f92672">(</span>model_id, prompt, temperature, max_tokens<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>    print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;Invoking llam model {model_id}&#34;</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;max_tokens {max_tokens}&#34;</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    try:
</span></span><span style="display:flex;"><span>        instruction <span style="color:#f92672">=</span> f<span style="color:#e6db74">&#34;[INST]You are a very intelligent bot with exceptional critical thinking, help me answering below question.[/INST]&#34;</span>
</span></span><span style="display:flex;"><span>        total_prompt <span style="color:#f92672">=</span> f<span style="color:#e6db74">&#34;{instruction}\n{prompt}&#34;</span> 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;Prompt template {total_prompt}&#34;</span> <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        bedrock_runtime_client <span style="color:#f92672">=</span> boto3.client<span style="color:#f92672">(</span>service_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bedrock-runtime&#34;</span>, region_name<span style="color:#f92672">=</span>region<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        body <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;prompt&#34;</span>: total_prompt,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;max_gen_len&#34;</span>: max_tokens,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;temperature&#34;</span>: temperature,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;top_p&#34;</span>: 0.9
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> bedrock_runtime_client.invoke_model<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>            modelId<span style="color:#f92672">=</span>model_id, body<span style="color:#f92672">=</span>json.dumps<span style="color:#f92672">(</span>body<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> json.loads<span style="color:#f92672">(</span>response<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;body&#34;</span><span style="color:#f92672">]</span>.read<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>        print<span style="color:#f92672">(</span>f<span style="color:#e6db74">&#34;response: {response_body}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response_body <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;generation&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    except Exception as e:
</span></span><span style="display:flex;"><span>        raise
</span></span></code></pre></div><ol start="3">
<li>From VSCode editor, run the following command to build and deploy with new updated lambda code.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~/environment/bedrock-serverless-workshop
</span></span><span style="display:flex;"><span>sam build <span style="color:#f92672">&amp;&amp;</span> sam deploy
</span></span></code></pre></div><p>You can inspect the updated Lambda function using <a href="https://console.aws.amazon.com/lambda/">AWS Lambda Console</a>.</p>
<p>In this task, you have the opportunity to work with following LLM models, each offering unique functionalities and specializations. These models include:</p>
<ul>
<li><strong>anthropic.claude-3-haiku</strong> - Claude 3 Haiku is Anthropic’s fastest, most compact model for near-instant responsiveness. Haiku is the best choice for building seamless AI experiences that mimic human interactions.</li>
<li><strong>anthropic.claude-3-5-sonnet</strong> - Anthropic’s most intelligent and advanced model, Claude 3.5 Sonnet, demonstrates exceptional capabilities across a diverse range of tasks and evaluation.</li>
<li><strong>anthropic.claude-3-opus</strong> - Opus is a highly intelligent model with reliable performance on complex tasks. It can navigate open-ended prompts and sight-unseen scenarios with remarkable fluency and human-like understanding. Use Opus to automate tasks, and accelerate research and development across a diverse range of use cases and industries.</li>
<li><strong>mistral.mistral-7b-instruct - Mistral</strong> is a highly efficient large language model optimized for high-volume, low-latency language-based tasks. Popular use cases for Mistral are text summarization, structuration, question answering, and code completion</li>
<li><strong>meta.llama3-1-8b-instruct - Llama 3.1 8B</strong> is best suited for limited computational power and resources. The model excels at text summarization, text classification, sentiment analysis, and language translation requiring low-latency inferencing.</li>
</ul>
<h2 id="test-using-ui">Test using UI</h2>
<ol>
<li>Return to the browser and open the chatbot webpage. If you are not signed in, use the credentials that you retrieved earlier to sign in. The webpage is displayed as follows:</li>
</ol>
<p><img src="https://github.com/PVinhP/PPV_Workshop_01/blob/main/Workshop/static/images/5.fwd/001.png?raw=true" alt="ConnectPrivate">
2. Ask any question by typing in the Query text box and click Ask Question button. You can try with a sample question from the right side panel. Here is a sample question and the response from Claude 3 Haiku. You can try with other LLMs and compare the results.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>List top <span style="color:#ae81ff">10</span> cities of VietNam by population?
</span></span></code></pre></div><hr>
<h3 id="task-complete">Task Complete</h3>
<p>You can now proceed to next task.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/5-multiplellms/" title="General Chat with Multiple LLMs"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/6-cleanup/" title="Clean up resources" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1753495745"></script>
    <script src="/js/perfect-scrollbar.min.js?1753495745"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1753495745"></script>
    <script src="/js/jquery.sticky.js?1753495745"></script>
    <script src="/js/featherlight.min.js?1753495745"></script>
    <script src="/js/highlight.pack.js?1753495745"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1753495745"></script>
    <script src="/js/learn.js?1753495745"></script>
    <script src="/js/hugo-learn.js?1753495745"></script>

    <link href="/mermaid/mermaid.css?1753495745" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1753495745"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
